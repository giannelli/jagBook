<?xml version="1.0" encoding="UTF-8" ?>
<chapter xml:id="integers" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Calculus</title>

    <introduction>
        <p>SageMath has excellent functionality for Calculus.  We will cover some of the basics here to give you some indication of what is possible.</p>
    </introduction>

    <section xml:id="calculus-limits">
        <title>Calculating Limits</title>

        <p>The concept of the limit is often used to define the integral and the derivative of functions.</p>

        <p>Here is an easy example to demonstrate Sage syntax for limits:</p>
        <sage>
            <input>
                var('x')

                f(x) = 1 / x
                show("Limit of 1/x as x->0+: {0}".format(limit(f, x=0,dir='plus')))
                show("Limit of 1/x as x->0-: {0}".format(limit(f, x=0,dir='minus')))
                p1 = plot(f, (x, -1, 1), detect_poles='show')
                p1.axes_range(-1, 1, -10, 10)
                p1.show()
            </input>
        </sage>


        <p>The following examples are taken from <xref ref="james_stewart">Essential Calculus - James Stewart</xref>.</p>

        <p>See also the <xref ref="sage_tutorial_limits">Sage Tutorial on Limits</xref>.</p>

        <p>The examples here (and some more can all been found in this (public) <url href="https://cloud.sagemath.com/projects/aab56d83-dc7e-435a-9c97-f420f3cfc10b/files/Calculus_Limits.sagews">Cloud SageMath Worksheet</url> </p>

        <p>Example 2, page 26</p>
        <sage>
            <input>
                f2 = (x-1)/(x^2-1)
                show(f2)
                f2.limit(x=1)
            </input>
            <output>1/2</output>
        </sage>

        <p>Plotting this function will give us a better picture of what is happening:</p>
        <sage>
            <input>
                pt = point((1, 1/2), rgbcolor='white', pointsize=30, faceted=True)
                p=plot(f2, -2,2, ymin=-5,ymax=5, exclude=[-1])
                p+pt
            </input>

        </sage>

        <figure>
            <image source="images/limits_ex2.png"/>
            <caption>Example 2, page 26</caption>
        </figure>

        <p>Stewart : Section 1.3, Exercise 12, page 33</p>
        <sage>
            <input>
                ex12=(x^2 - 2*x)/(x^2 - x - 2)
                show(ex12)
                #The show() method is not required in a sagemath worksheet
                #- but is needed here to display multiple lines in the output?
                show(ex12(x=0))
                show(ex12(x=-0.5))
                show(ex12(x=-0.9))
                show(ex12(x=-0.95))
                show(ex12(x=-0.99))
                show(ex12(x=-0.999))
                show(ex12.limit(x=-1))
                show(ex12(x=-2.0))
                show(ex12(x=-1.5))
                show(ex12(x=-1.1))
                show(ex12(x=-1.01))
                show(ex12(x=-1.001))
                show(ex12(x=-1.0001))
                show(ex12.limit(x=-1))
            </input>
        </sage>

        <p>From a plot or simplification of the equation you can visually see that there is an explosion at <m>-1</m>.</p>
        <sage>
            <input>
                #show() is not needed if doing this on a SageMath worksheet
                show(plot(ex12, -2,2, exclude=[-1], ymin=-10, ymax=10))
                show(ex12.simplify_full())
            </input>
            <output>\frac{x}{x + 1}</output>
        </sage>

        <p>
            Note that we have used an exclude list (square brackets is a list) with one entry, namely <m>-1</m>.
            See what happens if you take this out. Also note that we have explicitly determined the upper and lower <m>y</m> values.
            Again, experiment by taking these away or changing them.
        </p>

        <p>Stewart : Section 1.4, Exercise 14, page 44</p>
        <sage>
            <input>
                y_limit=var('y_limit')
                f=(x^2-4*x)/(x^2-3*x-4)
                y_limit=f.limit(x=4)
                show(f,"->",y_limit)
                p1=(0,y_limit)
                p2=(4,y_limit)
                p3=(4,0)
                pt1 = point(p1, rgbcolor='white', faceted=True, pointsize=30)
                pt2 = point(p2, rgbcolor='black', pointsize=30)
                l1 = line([p1, p2], linestyle='--')
                l2 = line([p2, p3], linestyle='--')
                pt1+pt2+l1+l2+plot(f, (x,0,5))
            </input>
        </sage>


    </section>

    <section xml:id="calculus-derivatives">
        <title>Derivatives</title>

        <p>Here are some basic examples to give a quick overview (without explanation) of how SageMath can be helpful
            for calculating derivatives:</p>
        <sage>
            <input>
                var('x, y')
                f(x, y) = 4 * x^5 * y^3 + 7 * y * x^2 - 6 * x + 2 * y
                show("f(x,y):",f)

                dfdx(x, y) = f.diff(x)
                show("df/dx:",dfdx)
                dfdy(x, y) = diff(f, y)
                show("df/dy:",dfdy)


                d2fdx2(x, y) = derivative(f, x, 2)    # Alias for diff
                show("Second x derivative :",d2fdx2)

                # Trigonometric functions
                g(x) = sqrt(x^3 + csc(x))
                show("g(x):",g)
                dgdx(x) = g.diff(x)
                show("dg/dx:",dgdx)

                # Implicit differentiation
                # The next line tells Sage that y is a function of x
                y(x) = function('y')(x)
                expr = 4 * y^2 + sin(y) == x^2

                show("Expression:",expr)

                # take the derivative and solve for dy/dx
                dydx = solve(diff(expr), diff(y))
                show(dydx[0])
            </input>
        </sage>

        <p>The following examples are taken from <xref ref="james_stewart">Essential Calculus - James Stewart, Chapter 2</xref>.</p>

        <p>All the examples,and more, can been found in this (public)
            <url href="https://cloud.sagemath.com/projects/aab56d83-dc7e-435a-9c97-f420f3cfc10b/files/Calculus_Derivatives.sagews">
                Cloud SageMath Worksheet</url>.</p>
        <p>Some of the examples from that worksheet are recreated here.</p>

        <subsection>
            <title>Examples From Chapter 2, Section 2.1</title>

            <p>
                Section 2.1, Exercise 25 - 30, Page 82
            </p>
            <sage>
                <input>
                    t=var('t')
                    f=3*x^2-4*x+1
                    show("f(t) = ", f, ", f'(t) = ", f.diff())

                    f=2*t^3+t
                    show("f(t) = ", f, ", f'(t) = ", f.diff())

                    f=(2*t+1)/(t+3)
                    show("f(t) = ", f, ", f'(t) = ", f.diff().simplify_full())

                    f=1/x^2
                    show("f(t) = ", f, ", f'(t) = ", f.diff())

                    f=sqrt(1-2*x)
                    show("f(t) = ", f, ", f'(t) = ", f.diff())

                    f=4/sqrt(1-x)
                    show("f(t) = ", f, ", f'(t) = ", f.diff())
                </input>
            </sage>

            <p>
                Section 2.1, Exercise 34, Page 82
            </p>

            <sage>
                <input>
                    f(x)=(tan(x)-1)/(x - pi/4)
                    f.show()  #Strange format but the displayed equation is correct!
                    limit=f.limit(x=pi/4);limit.show()
                    F=f.plot(0,pi,ymin=-5,ymax=5,exclude=[pi/2])

                    p1=(0,limit.n())
                    p2=(pi/4,limit.n())
                    p3=(pi/4,0)
                    pt1 = point(p1, rgbcolor='white', faceted=True, pointsize=30)
                    pt2 = point(p2, rgbcolor='black', pointsize=30)
                    pt3 = point(p3, rgbcolor='black', pointsize=30)
                    l1 = line([p1, p2], linestyle='--')
                    l2 = line([p2, p3], linestyle='--')

                    plt=F+pt2+l1+l2
                    plt.axes_labels([r'$x$',r'$\frac{\tan x - 1}{x - \pi/4}$'])
                    show(plt)
                </input>
            </sage>

            <p>
                Section 2.1, Exercise 49, Page 83
            </p>
            <sage>
                <input>
                    f(x)=x*sin(1/x)
                    Df=f.diff().simplify_full()

                    show("f(t) = ", f, ", f'(t) = ",Df)
                    show(Df.limit(x=0), " = undefined")

                    pltLargeScale=f.plot(-pi,pi)+Df.plot(-pi,pi,color='red',ymin=-2,ymax=2,detect_poles='show')
                    pltSmallScale=f.plot(-pi/10,pi/10)+Df.plot(-pi/10,pi/10,color='red',ymin=-1,ymax=1,detect_poles='show')
                    show(pltLargeScale)
                    show(pltSmallScale)
                </input>
            </sage>
            <p>
                Section 2.1, Exercise 50, Page 83
            </p>
            <sage>
                <input>
                    f(x)=x^2*sin(1/x)
                    Df=f.diff().simplify_full()

                    show("f(t) = ", f, ", f'(t) = ",Df)
                    show(Df.limit(x=0),  " = indeterminate")

                    pltLargeScale=f.plot(-pi,pi)+Df.plot(-pi,pi,color='red',ymin=-2,ymax=2,detect_poles='show')
                    pltSmallScale=f.plot(-pi/10,pi/10)+Df.plot(-pi/10,pi/10,color='red',ymin=-1,ymax=1,detect_poles='show')
                    show(pltLargeScale)
                    show(pltSmallScale)
                </input>
            </sage>
        </subsection>

        <subsection>
            <title>Implicit Differentiation</title>

            <p>The following examples make use of this predefined function.  It is not very robust
            and assumes that the <m>expr</m> argumnet is sage Expression type with variable <m>x</m> and <m>y</m>.</p>

            <p>Make sure you run this before running the other examples.  There will be no output but the function
            will be stored in memory available for use in other cells.</p>
            <sage>
                <input>
                    def my_implicit_derivative(expr):
                        show(expr)
                        f(x,y) = expr.lhs() - expr.rhs()
                        dydx = f.implicit_derivative(y,x)
                        pretty_print(r'\frac {dy}{dx}='+LatexExpr(latex(dydx)))
                        # show("Dy=",dydx) #Use this instead of the one above if you are using the online sage notebook.
                        return dydx
                </input>
            </sage>

            <p>Exercise 21 - Cardioid, Page 127</p>
            <sage>
                <input>
                    x,y,m= var('x,y,m')
                    expr=x^2+y^2 == (2*x^2+2*y^2-x)^2
                    dydx = my_implicit_derivative(expr)

                    pt=(0,1/2)

                    m=dydx(x=pt[0],y=pt[1])
                    #y=mx+c => c=y-mx (at point (1,1))
                    c=pt[1]-m*pt[0]
                    Y(x) = m*x + c
                    tangent="y={}".format(Y(x))
                    P1=point(pt,rgbcolor='black', pointsize=30)
                    P2=implicit_plot(expr, (x,-1,1), (y,-1,1),axes="true")
                    P3=plot(Y,(x,-1,1),color='red',legend_label=tangent,ymin=-1,ymax=1)
                    P1+P2+P3
                </input>
            </sage>

            <p>Exercise 23 - Lemniscate, Page 127</p>
            <sage>
                <input>
                    x,y,m= var('x,y,m')
                    expr=2*(x^2+y^2)^2 == 25*(x^2-y^2)
                    dydx = my_implicit_derivative(expr)
                    pt=(3,1)

                    m=dydx(x=pt[0],y=pt[1])
                    #y=mx+c => c=y-mx (at point (1,1))
                    c=pt[1]-m*pt[0]
                    Y(x) = m*x + c
                    tangent="y={}".format(Y(x))
                    P1=point(pt,rgbcolor='black', pointsize=30)
                    P2=implicit_plot(expr, (x,-5,5), (y,-5,5),axes="true")
                    P3=plot(Y,(x,-5,5),color='red',legend_label=tangent,ymin=-5,ymax=5)
                    P1+P2+P3
                </input>
            </sage>
        </subsection>
    </section>

    <section xml:id="calculus-integration">
        <title>Integration</title>

        <p>Here are some examples of indefinite integrals to demonstarte the power of SageMath:</p>
        <sage>
            <input>
                f = x^3
                show("function:",f,", Indefinite Integral = ",f.integrate(x))
                f= e^x
                show("function:",f,", Indefinite Integral = ",integral(f,x))
                f=1/x
                show("function:",f,", Indefinite Integral = ",integral(f,x))
                f=sinh(x)
                show("function:",f,", Indefinite Integral = ",f.integral(x))
                f=1/sqrt(1+x^2)
                show("function:",f,", Indefinite Integral = ",integral(f,x))

                show("Integration by parts:")
                f=e^x*cos(x)
                show("function:",f,", Indefinite Integral = ",f.integral(x))

                f=sqrt(x^2-25)/x
                show("function:",f,", Indefinite Integral = ",f.integral(x))
            </input>
        </sage>

        <p>Now for some Definite Integrals. For example:</p>
        <me>\int_{-1}^{1} \frac{1}{x^{2} + 1} dx = \frac{1}{2} \, \pi</me>
        <p>This can be confirmed in SageMath quite simply:</p>
        <sage>
            <input>
                f(x)=1/(1+x^2)
                show(f)
                f.integral(x, -1, 1).show()
            </input>
            <output>
                1/2*pi
            </output>
        </sage>
    </section>

    <xi:include href="sage/calculus-sage.xml" />
    <xi:include href="sage/calculus-sage-exercises.xml" />

    <references>
        <title>References</title>

        <biblio type="raw" xml:id="james_stewart">
            Stuart, James <title>Essential Calculus: Early Transcendentals</title>.
            Second Edition, 2013. ISBN-13: 978-1133112280, ISBN-10: 1133112285
            <url
                    href="https://www.amazon.co.uk/Essential-Calculus-Transcendentals-James-Stewart/dp/1133112285/ref=sr_1_1?ie=UTF8&amp;qid=1482949757&amp;sr=8-1&amp;keywords=9781133112280">
                Amazon UK
            </url>
        </biblio>

        <biblio type="raw" xml:id="sage_tutorial_limits">
            <url href="https://www.sagemath.org/calctut/limits.html">Sage Calculus Tutorial - Limits</url>
        </biblio>

        <biblio type="raw" xml:id="sage_tutorial_continuity">
            <url href="https://www.sagemath.org/calctut/continuity.html">Sage Calculus Tutorial - Continuity</url>
        </biblio>

        <biblio type="raw" xml:id="sage_tutorial_onesided">
            <url href="https://www.sagemath.org/calctut/onesided.html">Sage Calculus Tutorial - One Sided Limits</url>
        </biblio>

        <biblio type="raw" xml:id="sage_tutorial_inflimits">
            <url href="https://www.sagemath.org/calctut/inflimits.html">Sage Calculus Tutorial - Limits At Infinity</url>
        </biblio>

        <biblio type="raw" xml:id="sage_tutorial_slantasymp">
            <url href="https://www.sagemath.org/calctut/slantasymp.html">Sage Calculus Tutorial - Slant Asymptotes</url>
        </biblio>
    </references>

</chapter>
